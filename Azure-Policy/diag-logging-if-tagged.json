{
    "$schema": "https://schema.management.azure.com/schemas/2019-08-01/managementGroupDeploymentTemplate.json#", // https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#
    "contentVersion": "1.0.0.0",
    "parameters": {
      "managementGroupName" : {
        "type": "string"
      }
    },
    "variables": {
      "singleQuote": "'",
      "logAnalytics": "[concat('[parameters(', variables('singleQuote'), 'logAnalytics', variables('singleQuote'), ')]')]",
      "tagName": "[concat('[parameters(', variables('singleQuote'), 'tagName', variables('singleQuote'), ')]')]",
      "tagValue": "[concat('[parameters(', variables('singleQuote'), 'tagValue', variables('singleQuote'), ')]')]",
      "resourceName": "[concat('[parameters(', variables('singleQuote'), 'resourceName', variables('singleQuote'), ')]')]",
      "resourceDiagName": "[concat('[concat(', 'parameters(', variables('singleQuote'), 'resourceName', variables('singleQuote'), ')', ', ', variables('singleQuote'), '/', variables('singleQuote'), ', ', variables('singleQuote'), 'Microsoft.Insights/setByPolicy', variables('singleQuote'), ')]')]",
      "resourceNameField": "[concat('[field(', variables('singleQuote'), 'name', variables('singleQuote'), ')]')]",
      "resourceFullNameField": "[concat('[field(', variables('singleQuote'), 'fullName', variables('singleQuote'), ')]')]",
      "location": "[concat('[parameters(', variables('singleQuote'), 'location', variables('singleQuote'), ')]')]",
      "locationField": "[concat('[field(', variables('singleQuote'), 'location', variables('singleQuote'), ')]')]",
      "tagNameField": "[concat('[concat(', variables('singleQuote'), 'tags[', variables('singleQuote'), ', parameters(', variables('singleQuote'), 'tagName', variables('singleQuote'), '), ', variables('singleQuote'), ']', variables('singleQuote'), ')]')]",
      "tagValueField": "[concat('[parameters(', variables('singleQuote'), 'tagValue', variables('singleQuote'), ')]')]",
      "policyDescription": "This policy automatically deploys and enable diagnostic settings to Log Analytics",
      "nicDiagPolicyName": "nic-iftagged-diagnostic-settings-policyDef",
      "aaDiagPolicyName": "aa-iftagged-diagnostic-settings-policyDef",
      "pipDiagPolicyName": "pip-iftagged-diagnostic-settings-policyDef",
      "lbDiagPolicyName": "lb-iftagged-diagnostic-settings-policyDef",
      "nsgDiagPolicyName": "nsg-iftagged-diagnostic-settings-policyDef",
      "kvDiagPolicyName": "kv-iftagged-diagnostic-settings-policyDef",
      "cognitiveDiagPolicyName": "cognitive-iftagged-diagnostic-settings-policyDef",
      "dataLakeAnalyticsDiagPolicyName": "dlanalytics-iftagged-diagnostic-settings-policyDef",
      "dataLakeStoreDiagPolicyName": "dlstore-iftagged-diagnostic-settings-policyDef",
      "eventHubDiagPolicyName": "eventHub-iftagged-diagnostic-settings-policyDef",
      "iotHubDiagPolicyName": "iotHub-iftagged-diagnostic-settings-policyDef",
      "logicAppsWorkflowDiagPolicyName": "logicApps-workflow-iftagged-diagnostic-settings-policyDef",
      "logicAppsIntegrationAccountsDiagPolicyName": "logicApps-integrationAccts-iftag-diagnostic-settings-policyDef",
      "recoveryVaultDiagPolicyName": "recoveryVault-iftagged-diagnostic-settings-policyDef",
      "searchServicesDiagPolicyName": "searchServices-iftagged-diagnostic-settings-policyDef",
      "serviceBusDiagPolicyName": "serviceBus-iftagged-diagnostic-settings-policyDef",
      "sqlDBsDiagPolicyName": "sqlDBs-iftagged-diagnostic-settings-policyDef",
      "sqlElasticPoolsDiagPolicyName": "sqlElasticPools-iftagged-diagnostic-settings-policyDef",
      "sqlMIDiagPolicyName": "sql-mi-iftagged-diagnostic-settings-policyDef",
      "apiMgmtDiagPolicyName": "apiMgmt-iftagged-diagnostic-settings-policyDef",
      "appGwDiagPolicyName": "appGw-iftagged-diagnostic-settings-policyDef",
      "batchDiagPolicyName": "batch-iftagged-diagnostic-settings-policyDef",
      "mySQLDiagPolicyName": "mySQL-iftagged-diagnostic-settings-policyDef",
      "postgreSQLDiagPolicyName": "postgreSQL-iftagged-diagnostic-settings-policyDef",
      "cdnEndpointsDiagPolicyName": "cdnEndpoints-iftagged-diagnostic-settings-policyDef",
      "cosmosDBsDiagPolicyName": "cosmosDBs-iftagged-diagnostic-settings-policyDef",
      "dataFactoryDiagPolicyName": "dataFactory-iftagged-diagnostic-settings-policyDef",
      "firewallDiagPolicyName": "firewall-iftagged-diagnostic-settings-policyDef",
      "powerBIEmbeddedDiagPolicyName": "powerBIEmbedded-iftagged-diagnostic-settings-policyDef",
      "streamAnalyticsDiagPolicyName": "streamAnalytics-iftagged-diagnostic-settings-policyDef",
      "expressRoutesDiagPolicyName": "expressRoutes-iftagged-diagnostic-settings-policyDef",
      "aciDiagPolicyName": "aci-iftagged-diagnostic-settings-policyDef",
      "acrDiagPolicyName": "acr-iftagged-diagnostic-settings-policyDef",
      "vnetDiagPolicyName": "vnet-iftagged-diagnostic-settings-policyDef",
      "vmDiagPolicyName": "vm-iftagged-diagnostic-settings-policyDef",
      "vmssDiagPolicyName": "vmss-iftagged-diagnostic-settings-policyDef",
      "vnetGWDiagPolicyName": "vnetGW-iftagged-diagnostic-settings-policyDef",
      "aksDiagPolicyName": "aks-iftagged-diagnostic-settings-policyDef",
      "websiteDiagPolicyName": "website-iftagged-diagnostic-settings-policyDef",
      "webServerFarmDiagPolicyName": "webServerFarm-iftagged-diagnostic-settings-policyDef",
      "analysisServiceDiagPolicyName": "analysisService-iftagged-diagnostic-settings-policyDef",
      "eventGridTopicDiagPolicyName": "eventGridTopic-iftagged-diagnostic-settings-policyDef",
      "eventGridSubDiagPolicyName": "eventGridSub-iftagged-diagnostic-settings-policyDef",
      "hdInsightDiagPolicyName": "hdInsight-iftagged-diagnostic-settings-policyDef",
      "redisCacheDiagPolicyName": "redisCache-iftagged-diagnostic-settings-policyDef",
      "relayDiagPolicyName": "relay-iftagged-diagnostic-settings-policyDef",
      "signalRDiagPolicyName": "signalR-iftagged-diagnostic-settings-policyDef",
      "trafficManagerDiagPolicyName": "trafficManager-iftagged-diagnostic-settings-policyDef",
      "timeSeriesInsightsDiagPolicyName": "timeSeriesInsights-iftagged-diagnostic-settings-policyDef",
      "diagSettingsInitiativeName": "resource-iftagged-diagnostic-settings-policySet"
    },
    "resources": [{
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('nicDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [],
        "properties": {
          "displayName": "Apply diagnostic settings for Network Interfaces - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Network/networkInterfaces"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Network/networkInterfaces/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "timeGrain": null,
                            "enabled": true,
                            "retentionPolicy": {
                              "enabled": false,
                              "days": 0
                            }
                          }]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('aaDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('nicDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Azure Automation Accounts - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Automation/automationAccounts"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Automation/automationAccounts/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "timeGrain": null,
                            "enabled": true,
                            "retentionPolicy": {
                              "enabled": false,
                              "days": 0
                            }
                          }],
                          "logs": [{
                              "category": "JobLogs",
                              "enabled": true
                            },
                            {
                              "category": "JobStreams",
                              "enabled": true
                            },
                            {
                              "category": "DscNodeStatus",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('pipDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('aaDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Public IPs - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Network/publicIPAddresses"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Network/publicIPAddresses/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "timeGrain": null,
                            "enabled": true,
                            "retentionPolicy": {
                              "enabled": false,
                              "days": 0
                            }
                          }],
                          "logs": [{
                              "category": "DDoSProtectionNotifications",
                              "enabled": true
                            },
                            {
                              "category": "DDoSMitigationFlowLogs",
                              "enabled": true
                            },
                            {
                              "category": "DDoSMitigationReports",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('lbDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('pipDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Load Balancers - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Network/loadBalancers"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Network/loadBalancers/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "timeGrain": null,
                            "enabled": true,
                            "retentionPolicy": {
                              "enabled": false,
                              "days": 0
                            }
                          }],
                          "logs": [{
                              "category": "LoadBalancerAlertEvent",
                              "enabled": true
                            },
                            {
                              "category": "LoadBalancerProbeHealthStatus",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('nsgDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('lbDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Network Security Groups - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Network/networkSecurityGroups"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Network/networkSecurityGroups/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [],
                          "logs": [{
                              "category": "NetworkSecurityGroupEvent",
                              "enabled": true
                            },
                            {
                              "category": "NetworkSecurityGroupRuleCounter",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('kvDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('nsgDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Key Vaults - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.KeyVault/vaults"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.KeyVault/vaults/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                            "category": "AuditEvent",
                            "enabled": true
                          }]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('cognitiveDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('kvDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Cognitive Services - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.CognitiveServices/accounts"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.CognitiveServices/accounts/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                              "category": "Audit",
                              "enabled": true
                            },
                            {
                              "category": "RequestResponse",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('dataLakeAnalyticsDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('cognitiveDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Data Lake Analytics - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.DataLakeAnalytics/accounts"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.DataLakeAnalytics/accounts/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                              "category": "Audit",
                              "enabled": true
                            },
                            {
                              "category": "Requests",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('dataLakeStoreDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('dataLakeAnalyticsDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Data Lake Storage - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.DataLakeStore/accounts"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.DataLakeStore/accounts/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                              "category": "Audit",
                              "enabled": true
                            },
                            {
                              "category": "Requests",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('eventHubDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('dataLakeStoreDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Event Hub Namespaces - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.EventHub/namespaces"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.EventHub/namespaces/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                              "category": "ArchiveLogs",
                              "enabled": true
                            },
                            {
                              "category": "OperationalLogs",
                              "enabled": true
                            },
                            {
                              "category": "AutoScaleLogs",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('iotHubDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('eventHubDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for IoT Hubs - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Devices/IotHubs"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Devices/IotHubs/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                              "category": "Connections",
                              "enabled": true
                            },
                            {
                              "category": "DeviceTelemetry",
                              "enabled": true
                            },
                            {
                              "category": "C2DCommands",
                              "enabled": true
                            },
                            {
                              "category": "DeviceIdentityOperations",
                              "enabled": true
                            },
                            {
                              "category": "FileUploadOperations",
                              "enabled": true
                            },
                            {
                              "category": "Routes",
                              "enabled": true
                            },
                            {
                              "category": "D2CTwinOperations",
                              "enabled": true
                            },
                            {
                              "category": "C2DTwinOperations",
                              "enabled": true
                            },
                            {
                              "category": "TwinQueries",
                              "enabled": true
                            },
                            {
                              "category": "JobsOperations",
                              "enabled": true
                            },
                            {
                              "category": "DirectMethods",
                              "enabled": true
                            },
                            {
                              "category": "E2EDiagnostics",
                              "enabled": true
                            },
                            {
                              "category": "Configurations",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('logicAppsWorkflowDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('iotHubDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Logic Apps workflows - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Logic/workflows"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Logic/workflows/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                            "category": "WorkflowRuntime",
                            "enabled": true
                          }]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('logicAppsIntegrationAccountsDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('logicAppsWorkflowDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Logic Apps Integration Accounts - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Logic/integrationAccounts"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Logic/integrationAccounts/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [],
                          "logs": [{
                            "category": "IntegrationAccountTrackingEvents",
                            "enabled": true
                          }]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('recoveryVaultDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('logicAppsIntegrationAccountsDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Recovery Vaults - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.RecoveryServices/vaults"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.RecoveryServices/vaults/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [],
                          "logs": [{
                              "category": "AzureBackupReport",
                              "enabled": true
                            },
                            {
                              "category": "AzureSiteRecoveryJobs",
                              "enabled": true
                            },
                            {
                              "category": "AzureSiteRecoveryEvents",
                              "enabled": true
                            },
                            {
                              "category": "AzureSiteRecoveryReplicatedItems",
                              "enabled": true
                            },
                            {
                              "category": "AzureSiteRecoveryReplicationStats",
                              "enabled": true
                            },
                            {
                              "category": "AzureSiteRecoveryRecoveryPoints",
                              "enabled": true
                            },
                            {
                              "category": "AzureSiteRecoveryReplicationDataUploadRate",
                              "enabled": true
                            },
                            {
                              "category": "AzureSiteRecoveryProtectedDiskDataChurn",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('searchServicesDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('recoveryVaultDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Search Services - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Search/searchServices"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Search/searchServices/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                            "category": "OperationLogs",
                            "enabled": true
                          }]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('serviceBusDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('searchServicesDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Service Bus namespaces - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.ServiceBus/namespaces"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.ServiceBus/namespaces/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                            "category": "OperationalLogs",
                            "enabled": true
                          }]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('sqlDBsDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('serviceBusDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for SQL Databases - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Sql/servers/databases"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Sql/servers/databases/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                              "category": "SQLInsights",
                              "enabled": true
                            },
                            {
                              "category": "AutomaticTuning",
                              "enabled": true
                            },
                            {
                              "category": "QueryStoreRuntimeStatistics",
                              "enabled": true
                            },
                            {
                              "category": "QueryStoreWaitStatistics",
                              "enabled": true
                            },
                            {
                              "category": "Errors",
                              "enabled": true
                            },
                            {
                              "category": "DatabaseWaitStatistics",
                              "enabled": true
                            },
                            {
                              "category": "Timeouts",
                              "enabled": true
                            },
                            {
                              "category": "Blocks",
                              "enabled": true
                            },
                            {
                              "category": "Deadlocks",
                              "enabled": true
                            },
                            {
                              "category": "Audit",
                              "enabled": true
                            },
                            {
                              "category": "SQLSecurityAuditEvents",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceFullNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('sqlElasticPoolsDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('sqlDBsDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for SQL Elastic Pools - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Sql/servers/elasticPools"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Sql/servers/elasticPools/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": []
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceFullNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('apiMgmtDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('sqlElasticPoolsDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for API Management services - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.ApiManagement/service"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.ApiManagement/service/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                              "category": "Gateway Requests",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            },
                            {
                              "category": "Capacity",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            },
                            {
                              "category": "EventHub Events",
                              "enabled": true,
                              "retentionPolicy": {
                                "days": 0,
                                "enabled": false
                              },
                              "timeGrain": null
                            }
                          ],
                          "logs": [{
                            "category": "GatewayLogs",
                            "enabled": true
                          }]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('appGwDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('apiMgmtDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Application Gateways - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Network/applicationGateways"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Network/applicationGateways/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                              "category": "ApplicationGatewayAccessLog",
                              "enabled": true
                            },
                            {
                              "category": "ApplicationGatewayPerformanceLog",
                              "enabled": true
                            },
                            {
                              "category": "ApplicationGatewayFirewallLog",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('batchDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('appGwDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Azure Batch accounts - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Batch/batchAccounts"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Batch/batchAccounts/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                            "category": "ServiceLog",
                            "enabled": true
                          }]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('mySQLDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('batchDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for MySQL Databases - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.DBforMySQL/servers"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.DBforMySQL/servers/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                            "category": "MySqlSlowLogs",
                            "enabled": true
                          }]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('postgreSQLDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('mySQLDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for PostgreSQL Databases - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.DBforPostgreSQL/servers"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.DBforPostgreSQL/servers/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                            "category": "PostgreSQLLogs",
                            "enabled": true
                          }]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('cdnEndpointsDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('postgreSQLDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for CDN Endpoints - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Cdn/profiles/endpoints"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Cdn/profiles/endpoints/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [],
                          "logs": [{
                            "category": "CoreAnalytics",
                            "enabled": true
                          }]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceFullNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('cosmosDBsDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('cdnEndpointsDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Cosmos DB - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.DocumentDB/databaseAccounts"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.DocumentDB/databaseAccounts/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "Requests",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                              "category": "DataPlaneRequests",
                              "enabled": true
                            },
                            {
                              "category": "MongoRequests",
                              "enabled": true
                            },
                            {
                              "category": "QueryRuntimeStatistics",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('dataFactoryDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('cosmosDBsDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Data Factory - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.DataFactory/factories"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.DataFactory/factories/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                              "category": "ActivityRuns",
                              "enabled": true
                            },
                            {
                              "category": "PipelineRuns",
                              "enabled": true
                            },
                            {
                              "category": "TriggerRuns",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('firewallDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('dataFactoryDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Azure Firewalls - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Network/azureFirewalls"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Network/azureFirewalls/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                              "category": "AzureFirewallApplicationRule",
                              "enabled": true
                            },
                            {
                              "category": "AzureFirewallNetworkRule",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('powerBIEmbeddedDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('firewallDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Power BI Embedded - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.PowerBIDedicated/capacities"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.PowerBIDedicated/capacities/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                            "category": "Engine",
                            "enabled": true
                          }]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('streamAnalyticsDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('powerBIEmbeddedDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Stream Analytics - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.StreamAnalytics/streamingjobs"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.StreamAnalytics/streamingjobs/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                              "category": "Execution",
                              "enabled": true
                            },
                            {
                              "category": "Authoring",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('expressRoutesDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('streamAnalyticsDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Express Routes Circuits - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Network/expressRouteCircuits"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Network/expressRouteCircuits/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                            "category": "PeeringRouteLog",
                            "enabled": true
                          }]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('aciDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('expressRoutesDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Azure Container Instances - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.ContainerInstance/containerGroups"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.ContainerInstance/containerGroups/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": []
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('acrDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('aciDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Azure Container Registries - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.ContainerRegistry/registries"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.ContainerRegistry/registries/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": []
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('vnetDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('acrDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Virtual Networks - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Network/virtualNetworks"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Network/virtualNetworks/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [],
                          "logs": [{
                            "category": "VMProtectionAlerts",
                            "enabled": true
                          }]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('vmDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('vnetDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Virtual Machines - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Compute/virtualMachines"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Compute/virtualMachines/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "enabled": false,
                              "days": 0
                            }
                          }],
                          "logs": []
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('vmssDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('vmDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Virtual Machine Scale Sets - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Compute/virtualMachineScaleSets"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Compute/virtualMachineScaleSets/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "enabled": false,
                              "days": 0
                            }
                          }],
                          "logs": []
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('vnetGWDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('vmssDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Virtual Network Gateways - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Network/virtualNetworkGateways"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Network/virtualNetworkGateways/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                              "category": "GatewayDiagnosticLog",
                              "enabled": true
                            },
                            {
                              "category": "IKEDiagnosticLog",
                              "enabled": true
                            },
                            {
                              "category": "P2SDiagnosticLog",
                              "enabled": true
                            },
                            {
                              "category": "RouteDiagnosticLog",
                              "enabled": true
                            },
                            {
                              "category": "RouteDiagnosticLog",
                              "enabled": true
                            },
                            {
                              "category": "TunnelDiagnosticLog",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('aksDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('vnetGWDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Azure Kubernetes Service - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.ContainerService/managedClusters"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.ContainerService/managedClusters/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                              "category": "guard",
                              "enabled": true
                            },
                            {
                              "category": "kube-apiserver",
                              "enabled": true
                            },
                            {
                              "category": "kube-controller-manager",
                              "enabled": true
                            },
                            {
                              "category": "kube-scheduler",
                              "enabled": true
                            },
                            {
                              "category": "cluster-autoscaler",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('websiteDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('aksDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Azure Web Sites",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Web/sites"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Web/sites/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": []
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('analysisServiceDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('websiteDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Azure Analysis Services - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.AnalysisServices/servers"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.AnalysisServices/servers/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                              "category": "Engine",
                              "enabled": true
                            },
                            {
                              "category": "Service",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('eventGridTopicDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('analysisServiceDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Event Grid Topics - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.EventGrid/topics"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.EventGrid/topics/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": []
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('eventGridSubDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('eventGridTopicDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Event Grid Subscriptions - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.EventGrid/eventSubscriptions"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.EventGrid/eventSubscriptions/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": []
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('hdInsightDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('eventGridSubDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for HDInsight - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.HDInsight/clusters"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.HDInsight/clusters/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": []
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('redisCacheDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('hdInsightDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Redis Cache - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Cache/redis"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Cache/redis/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": []
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('relayDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('redisCacheDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Azure Relay - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Relay/namespaces"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Relay/namespaces/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": []
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('signalRDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('relayDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for SignalR - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.SignalRService/SignalR"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.SignalRService/SignalR/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": []
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('trafficManagerDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('signalRDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Azure Traffic Manager - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Network/trafficManagerProfiles"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Network/trafficManagerProfiles/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": [{
                            "category": "ProbeHealthStatusEvents",
                            "enabled": true
                          }]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('webServerFarmDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('trafficManagerDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Azure App Service Plans - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Web/serverfarms"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Web/serverfarms/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": []
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('sqlMIDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('webServerFarmDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for SQL Managed Instances - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.Sql/managedInstances"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.Sql/managedInstances/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "logs": [{
                              "category": "ResourceUsageStats",
                              "enabled": true
                            },
                            {
                              "category": "SQLSecurityAuditEvents",
                              "enabled": true
                            }
                          ]
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('timeSeriesInsightsDiagPolicyName')]",
        "apiVersion": "2018-05-01",
        "dependsOn": [
          "[variables('sqlMIDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for Time Series Insights - Log Analytics",
          "description": "[variables('policyDescription')]",
          "metadata": {
            "category": "Monitoring"
          },
          "mode": "all",
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyRule": {
            "if": {
              "allOf": [{
                  "field": "type",
                  "equals": "Microsoft.TimeSeriesInsights/environments"
                },
                {
                  "field": "[variables('tagNameField')]",
                  "equals": "[variables('tagValueField')]"
                }
              ]
            },
            "then": {
              "effect": "deployIfNotExists",
              "details": {
                "type": "Microsoft.Insights/diagnosticSettings",
                "name": "setByPolicy",
                "roleDefinitionIds": [
                  "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                ],
                "deployment": {
                  "properties": {
                    "mode": "incremental",
                    "template": {
                      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "resourceName": {
                          "type": "string"
                        },
                        "logAnalytics": {
                          "type": "string"
                        },
                        "location": {
                          "type": "string"
                        }
                      },
                      "variables": {},
                      "resources": [{
                        "type": "Microsoft.TimeSeriesInsights/environments/providers/diagnosticSettings",
                        "apiVersion": "2017-05-01-preview",
                        "name": "[variables('resourceDiagName')]",
                        "location": "[variables('location')]",
                        "dependsOn": [],
                        "properties": {
                          "workspaceId": "[variables('logAnalytics')]",
                          "metrics": [{
                            "category": "AllMetrics",
                            "enabled": true,
                            "retentionPolicy": {
                              "days": 0,
                              "enabled": false
                            },
                            "timeGrain": null
                          }],
                          "logs": []
                        }
                      }],
                      "outputs": {}
                    },
                    "parameters": {
                      "logAnalytics": {
                        "value": "[variables('logAnalytics')]"
                      },
                      "location": {
                        "value": "[variables('locationField')]"
                      },
                      "resourceName": {
                        "value": "[variables('resourceNameField')]"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Authorization/policySetDefinitions",
        "name": "[variables('diagSettingsInitiativeName')]",
        "apiVersion": "2019-09-01",
        "dependsOn": [
          "[variables('timeSeriesInsightsDiagPolicyName')]"
        ],
        "properties": {
          "displayName": "Apply diagnostic settings for applicable resources - Log Analytics",
          "description": "This initiative configures application Azure resources to forward diagnostic logs and metrics to an Azure Log Analytics workspace.",
          "metadata": {
            "category": "Monitoring"
          },
          "parameters": {
            "logAnalytics": {
              "type": "string",
              "metadata": {
                "displayName": "Log Analytics workspace",
                "description": "Select the Log Analytics workspace from dropdown list",
                "strongType": "omsWorkspace"
              }
            },
            "tagName": {
              "type": "String",
              "metadata": {
                "displayName": "Name of tag, ex. environment",
                "description": "Name of tag, ex. environment"
              }
            },
            "tagValue": {
              "type": "String",
              "metadata": {
                "displayName": "Tag value, ex. production",
                "description": "Resources tagged with this value will be affected by this policy"
              }
            }
          },
          "policyDefinitions": [{
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('nicDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('aaDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('pipDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('lbDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('nsgDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('kvDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('cognitiveDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('dataLakeAnalyticsDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('dataLakeStoreDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('eventHubDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('iotHubDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('logicAppsWorkflowDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('logicAppsIntegrationAccountsDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('recoveryVaultDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('searchServicesDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('serviceBusDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('sqlDBsDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('sqlElasticPoolsDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('apiMgmtDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('appGwDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('batchDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('mySQLDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('postgreSQLDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('cdnEndpointsDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('cosmosDBsDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('dataFactoryDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('firewallDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('powerBIEmbeddedDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('streamAnalyticsDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('expressRoutesDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('aciDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('acrDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('vnetDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('vmDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('vmssDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('vnetGWDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('aksDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('websiteDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('analysisServiceDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('eventGridTopicDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('eventGridSubDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('hdInsightDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('redisCacheDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('relayDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('signalRDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('trafficManagerDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('webServerFarmDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('sqlMIDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            },
            {
              "policyDefinitionId": "[extensionResourceId(resourceId('Microsoft.Management/managementGroups', parameters('managementGroupName')), 'Microsoft.Authorization/policyDefinitions/', variables('timeSeriesInsightsDiagPolicyName'))]",
              "parameters": {
                "logAnalytics": {
                  "value": "[variables('logAnalytics')]"
                },
                "tagName": {
                  "value": "[variables('tagName')]"
                },
                "tagValue": {
                  "value": "[variables('tagValue')]"
                }
              }
            }
          ]
        }
      }
    ],
    "outputs": {}
  }